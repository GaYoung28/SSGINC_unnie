<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>내 업체 조회</title>
    <style>
        /* 기본 페이지 스타일 */
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        .container {
            width: 640px;
            margin: 50px auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #fafafa;
        }

        /* 상세보기 버튼 */
        .details-button {
            background-color: #ff3479;
            color: #fff;
            padding: 8px 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .details-button:hover {
            background-color: #ff3479;
        }

        /* 드롭다운 상세 정보 스타일 */
        .dropdown-content {
            display: block;
            max-height: 0;
            padding: 0 10px;
            background-color: #fafafa;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }

        /* 섹션 헤딩 */
        .section-title {
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: bold;
            color: #ff3479;
        }

        /* 단락 스타일 */
        p {
            margin: 8px 0;
            line-height: 1.4;
        }

        /* 사진(이미지) 영역 (예시) */
        .photo-placeholder {
            width: 100px;
            height: 80px;
            background-color: #ffe2ec;
            display: inline-block;
            vertical-align: middle;
            text-align: center;
            line-height: 80px;
            color: #ff3479;
            margin: 4px 0;
            border-radius: 4px;
            font-weight: bold;
        }

        /* 사진과 텍스트를 나란히 배치 */
        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .info-item img {
            margin-right: 10px;
        }

        .info-item p {
            margin: 0;
        }

        img.thumbnail {
            width: 100px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>내 업체 조회</h1>
    <table>
        <thead>
        <tr>
            <th>업체명</th>
            <th>성명(대표자)</th>
            <th>구분</th>
            <th>주소</th>
            <th>상세보기</th>
        </tr>
        </thead>
        <tbody id="shopTableBody">
        <!-- 백엔드에서 받아온 데이터를 기반으로 행들이 동적으로 생성됩니다. -->
        </tbody>
    </table>
</div>

<script>
    let lastOpenedDropdown = null; // 마지막으로 열린 드롭다운을 추적

    // 드롭다운을 토글하는 함수
    function toggleDropdown(id) {
        var dropdown = document.getElementById(id);

        // 이전에 열려있던 드롭다운을 닫기
        if (lastOpenedDropdown && lastOpenedDropdown !== dropdown) {
            lastOpenedDropdown.style.maxHeight = '0';
        }

        // 현재 드롭다운이 닫혀있으면 열기, 열려있으면 닫기
        if (dropdown.style.maxHeight === '0px' || dropdown.style.maxHeight === '') {
            dropdown.style.maxHeight = dropdown.scrollHeight + 'px'; // 실제 높이로 설정
            lastOpenedDropdown = dropdown; // 현재 드롭다운을 기억
        } else {
            dropdown.style.maxHeight = '0'; // 닫기
            lastOpenedDropdown = null;
        }
    }

    // 업체 데이터를 백엔드에서 받아와 테이블에 채워 넣는 함수
    async function fetchShops(page = 1, pageSize = 5) {
        try {
            const response = await fetch(`/api/mypage/manager/myshops?page=${page}&pageSize=${pageSize}`);
            const data = await response.json();
            let shopPage = data.data.shop;
            let shops = shopPage.list;  // 실제 데이터 구조에 맞게 수정 필요
            let tableBody = document.getElementById("shopTableBody");
            tableBody.innerHTML = "";  // 기존 내용 제거

            shops.forEach((shop, index) => {
                let row = document.createElement("tr");
                row.innerHTML = `
                    <td>${shop.shopName}</td>
                    <td>${shop.shopRepresentationName}</td>
                    <td>${shop.shopCategory}</td>
                    <td>${shop.shopLocation}</td>
                    <td>
                        <button class="details-button" onclick="fetchShopDetail(${shop.shopId}, 'dropdown${index}')">
                            상세보기
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);

                // 상세 정보 드롭다운 행 생성
                let detailRow = document.createElement("tr");
                let detailCell = document.createElement("td");
                detailCell.setAttribute("colspan", "5");
                detailCell.innerHTML = `
                    <div id="dropdown${index}" class="dropdown-content">
                        <!-- 여기에 상세 정보가 동적으로 추가됩니다. -->
                    </div>
                `;
                detailRow.appendChild(detailCell);
                tableBody.appendChild(detailRow);
            });
        } catch (error) {
            console.error("업체 데이터를 불러오는 중 오류 발생:", error);
        }
    }

    // 업체 상세 데이터를 불러오는 함수
    async function fetchShopDetail(shopId, dropdownId) {
        try {
            const response = await fetch(`/api/mypage/manager/shopdetail/${shopId}`);
            const data = await response.json();
            const shop = data.data.shop;

            const shopDetailContainer = document.getElementById(dropdownId);
            shopDetailContainer.innerHTML = `
                <div class="section-title">업체 정보</div>
                <p><strong>업체명:</strong> ${shop.shopName}</p>
                <p><strong>업체 위치:</strong> ${shop.shopLocation}</p>
                <p><strong>카테고리:</strong> ${shop.shopCategory}</p>
                <p><strong>영업시간:</strong> ${shop.shopBusinessTime}</p>
                <p><strong>전화번호:</strong> ${shop.shopTel}</p>
                <p><strong>업체 소개:</strong> ${shop.shopIntroduction}</p>
                <p><strong>휴무일:</strong> ${shop.shopClosedDay}</p>
                <p><strong>사업자 등록번호:</strong> ${shop.shopBusinessNumber}</p>
                <p><strong>대표자명:</strong> ${shop.shopRepresentationName}</p>

                <div class="section-title">디자이너 정보</div>
                ${shop.designers.length > 0 ? shop.designers.map(designer => `
                    <div class="info-item">
                        <img class="thumbnail" src="${designer.designerThumbnail}">
                        <div>
                            <p><strong>디자이너명:</strong> ${designer.designerName}</p>
                            <p><strong>디자이너 소개:</strong> ${designer.designerIntroduction}</p>
                        </div>
                    </div>
                `).join('') : '<p>디자이너 정보가 없습니다.</p>'}

                <div class="section-title">시술 정보</div>
                ${shop.procedures.length > 0 ? shop.procedures.map(procedure => `
                    <div class="info-item">
                        <img class="thumbnail" src="${procedure.procedureThumbnail}">
                        <div>
                            <p><strong>시술명:</strong> ${procedure.procedureName}</p>
                            <p><strong>가격:</strong> ${procedure.procedurePrice}</p>
                        </div>
                    </div>
                `).join('') : '<p>시술 정보가 없습니다.</p>'}
            `;
            toggleDropdown(dropdownId);
        } catch (error) {
            console.error("업체 상세 정보를 불러오는 중 오류 발생:", error);
        }
    }

    fetchShops();
</script>

</body>
</html>
